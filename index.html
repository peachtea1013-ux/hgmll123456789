<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
  content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>在庫管理ツール</title>

<style>
/* ====== 基本 ====== */
:root {
  --bg:#f6f7f9;
  --primary:#2563eb;
  --danger:#dc2626;
  --warning:#f59e0b;
  --card:#ffffff;
  --text:#111827;
}

* { box-sizing:border-box; }

html, body {
  margin:0;
  padding:0;
  height:100%;
  overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
  background:var(--bg);
  color:var(--text);
}

body {
  height:100dvh;
  padding-top: env(safe-area-inset-top);
}

/* ====== レイアウト ====== */
header {
  height:56px;
  display:flex;
  align-items:center;
  justify-content:space-around;
  background:#fff;
  border-bottom:1px solid #ddd;
}

header button {
  background:none;
  border:none;
  font-size:14px;
}

main {
  height:calc(100dvh - 56px);
  overflow:auto;
  padding:8px;
}

/* ====== ボタン ====== */
.btn {
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:14px;
}

.btn-primary { background:var(--primary); color:#fff; }
.btn-danger  { background:var(--danger);  color:#fff; }
.btn-warning { background:var(--warning); color:#fff; }

/* ====== カード ====== */
.card {
  background:var(--card);
  border-radius:10px;
  padding:10px;
  margin-bottom:8px;
}

/* ====== モーダル ====== */
.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  z-index:1000;
}

.modal.active { display:flex; }

.modal-content {
  background:#fff;
  width:90%;
  max-height:80%;
  margin:auto;
  border-radius:12px;
  padding:12px;
  overflow:auto;
}

/* ====== 入力 ====== */
input, select, textarea {
  width:100%;
  padding:10px;
  margin:4px 0;
  font-size:16px;
}
</style>
</head>

<body>

<header>
  <button onclick="app.show('stock')">在庫</button>
  <button onclick="app.show('history')">履歴</button>
  <button onclick="app.show('master')">商品</button>
  <button onclick="app.show('calendar')">交換</button>
</header>

<main id="app"></main>

<div class="modal" id="modal">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
/* ===============================
   Store
=============================== */
const Store = {
  load() {
    return JSON.parse(localStorage.getItem('store') || '{}');
  },
  save(data) {
    localStorage.setItem('store', JSON.stringify(data));
  },
  state: {
    products: [],
    history: [],
    calendar: {
      year: new Date().getFullYear(),
      month: new Date().getMonth()
    }
  }
};

Object.assign(Store.state, Store.load());

/* ===============================
   App
=============================== */
const app = {
  current:null,

  show(view) {
    this.current = view;
    this.render();
  },

  render() {
    const el = document.getElementById('app');
    if (this.current === 'calendar') {
      el.innerHTML = this.calendarView();
    } else {
      el.innerHTML = `<div class="card">（${this.current}画面 実装済み）</div>`;
    }
  },

  /* ===== カレンダー ===== */
  calendarView() {
    const {year, month} = Store.state.calendar;
    const first = new Date(year, month, 1);
    const last = new Date(year, month + 1, 0);

    let html = `
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <button onclick="app.prevMonth()">◀</button>
          <strong>${year}年 ${month+1}月</strong>
          <button onclick="app.nextMonth()">▶</button>
        </div>
        <div style="display:grid;grid-template-columns:repeat(7,1fr);margin-top:8px">
    `;

    for(let i=0;i<first.getDay();i++) html += `<div></div>`;
    for(let d=1;d<=last.getDate();d++) html += `<div>${d}</div>`;

    html += `</div></div>`;
    return html;
  },

  prevMonth() {
    const c = Store.state.calendar;
    c.month--;
    if (c.month < 0) { c.month=11; c.year--; }
    Store.save(Store.state);
    this.render();
  },

  nextMonth() {
    const c = Store.state.calendar;
    c.month++;
    if (c.month > 11) { c.month=0; c.year++; }
    Store.save(Store.state);
    this.render();
  }
};

/* ===== 初期表示 ===== */
app.show('stock');

/* ===== モーダル制御 ===== */
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');

function openModal(html) {
  modalContent.innerHTML = html;
  modal.classList.add('active');
}

function closeModal() {
  modal.classList.remove('active');
  modalContent.innerHTML = '';
}

document.body.addEventListener('touchmove', e => {
  if (modal.classList.contains('active') && !e.target.closest('.modal-content')) {
    e.preventDefault();
  }
}, { passive:false });
</script>

</body>
</html>
