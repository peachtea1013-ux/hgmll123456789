<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>åœ¨åº«ç®¡ç† Pro</title>
<style>
/* --- CSS Variables & Reset --- */
:root {
    --primary: #007AFF;
    --danger: #FF3B30;
    --warning: #FF9500;
    --success: #34C759;
    --bg: #F2F2F7;
    --card: #FFFFFF;
    --text: #000000;
    --subtext: #8E8E93;
    --border: #C6C6C8;
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    margin: 0; padding: 0; background-color: var(--bg); color: var(--text);
    height: 100vh; display: flex; flex-direction: column; overflow: hidden;
}

/* --- Layout --- */
header {
    background: var(--card); padding: calc(var(--safe-top) + 10px) 16px 10px;
    border-bottom: 1px solid var(--border); z-index: 100;
    display: flex; justify-content: space-between; align-items: center;
}
header h1 { margin: 0; font-size: 18px; font-weight: 600; }
main { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: calc(60px + var(--safe-bottom)); -webkit-overflow-scrolling: touch; }

/* --- Navigation --- */
nav {
    position: fixed; bottom: 0; left: 0; width: 100%; background: var(--card);
    border-top: 1px solid var(--border); padding-bottom: var(--safe-bottom);
    display: flex; justify-content: space-around; z-index: 100;
}
.nav-item {
    flex: 1; text-align: center; padding: 10px 0; color: var(--subtext); font-size: 10px;
    background: none; border: none; cursor: pointer;
}
.nav-item.active { color: var(--primary); font-weight: bold; }
.nav-icon { font-size: 24px; display: block; margin-bottom: 2px; }

/* --- Components --- */
.card { background: var(--card); border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.btn {
    display: inline-flex; justify-content: center; align-items: center;
    padding: 12px; border-radius: 8px; font-size: 16px; font-weight: 600;
    border: none; cursor: pointer; width: 100%; transition: opacity 0.2s;
}
.btn:active { opacity: 0.7; }
.btn-primary { background: var(--primary); color: white; }
.btn-danger { background: var(--danger); color: white; }
.btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
.btn-sm { padding: 6px 12px; font-size: 13px; width: auto; }

input, select, textarea {
    width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px;
    font-size: 16px; margin-bottom: 12px; background: var(--card); -webkit-appearance: none;
}
input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); }

/* --- Specific Views --- */
/* Inventory List */
.filter-bar { display: flex; gap: 8px; margin-bottom: 12px; }
.search-box { flex: 1; margin: 0; }
.cat-badge {
    padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;
    display: inline-block; margin-right: 6px;
}
.stock-row { display: flex; justify-content: space-between; align-items: center; }
.stock-val { font-size: 20px; font-weight: bold; }
.stock-actions { display: flex; gap: 8px; margin-top: 12px; }
.alert-row { background-color: #ffe5e5; border: 1px solid var(--danger); }
.order-row { background-color: #fff4e5; border: 1px solid var(--warning); }

/* Modal */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); z-index: 200;
    display: none; align-items: flex-end; justify-content: center;
}
.modal-overlay.active { display: flex; }
.modal-content {
    background: var(--bg); width: 100%; max-height: 90vh;
    border-radius: 16px 16px 0 0; padding: 20px; overflow-y: auto;
}
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }

/* Calendar */
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 20px; }
.cal-day {
    background: var(--card); height: 44px; display: flex; flex-direction: column;
    align-items: center; justify-content: center; border-radius: 4px; font-size: 12px; position: relative;
}
.cal-day.has-event { border: 2px solid var(--primary); font-weight: bold; }
.cal-day.today { background: var(--primary); color: white; }
.week-header { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 12px; margin-bottom: 4px; }

/* Toggle Switch */
.switch-wrap { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--primary); }
input:checked + .slider:before { transform: translateX(22px); }

/* Utilities */
.hidden { display: none !important; }
.text-danger { color: var(--danger); }
.text-warning { color: var(--warning); }
</style>
</head>
<body>

<header>
    <h1 id="page-title">åœ¨åº«ç®¡ç†</h1>
    <div id="header-actions"></div>
</header>

<main id="app-container">
    </main>

<nav id="main-nav">
    <button class="nav-item active" onclick="app.router('inventory')">
        <span class="nav-icon">ğŸ“¦</span>åœ¨åº«
    </button>
    <button class="nav-item" onclick="app.router('history')">
        <span class="nav-icon">ğŸ•’</span>å±¥æ­´
    </button>
    <button class="nav-item" onclick="app.router('master')">
        <span class="nav-icon">ğŸ“</span>ãƒã‚¹ã‚¿
    </button>
    <button class="nav-item" onclick="app.router('calendar')">
        <span class="nav-icon">ğŸ“…</span>äºˆå®š
    </button>
    <button class="nav-item" onclick="app.router('settings')">
        <span class="nav-icon">âš™ï¸</span>è¨­å®š
    </button>
</nav>

<div id="modal" class="modal-overlay" onclick="if(event.target===this) app.closeModal()">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modal-title">Title</h2>
            <button class="btn-sm btn-outline" onclick="app.closeModal()">é–‰ã˜ã‚‹</button>
        </div>
        <div id="modal-body"></div>
    </div>
</div>

<script>
/**
 * ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */
const Utils = {
    uuid: () => Date.now().toString(36) + Math.random().toString(36).substr(2),
    formatDate: (d) => new Date(d).toLocaleString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }),
    formatDateShort: (d) => new Date(d).toISOString().split('T')[0],
    
    // ã‚«ãƒ†ã‚´ãƒªåã‹ã‚‰ä¸€æ„ã®è‰²ï¼ˆHSLï¼‰ã‚’ç”Ÿæˆ
    getColor: (str) => {
        if(!str) return '#ccc';
        let hash = 0;
        for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
        return `hsl(${Math.abs(hash % 360)}, 70%, 90%)`; // æ·¡ã„èƒŒæ™¯è‰²
    },

    // CSVãƒ‘ãƒ¼ã‚¹ (BOMå¯¾å¿œ)
    parseCSV: (text) => {
        const rows = text.replace(/^\uFEFF/, '').split(/\r\n|\n/).filter(r => r.trim());
        const headers = rows[0].split(',');
        return rows.slice(1).map(row => {
            const values = row.split(',');
            return headers.reduce((obj, header, i) => {
                obj[header] = values[i];
                return obj;
            }, {});
        });
    },

    // ä¼‘æ—¥ã‚’è€ƒæ…®ã—ãŸæ—¥ä»˜è¨ˆç®—
    addBusinessDays: (dateStr, days) => {
        let d = new Date(dateStr);
        d.setDate(d.getDate() + days);
        // åœŸ(6)ãªã‚‰+2ã§æœˆæ›œã€æ—¥(0)ãªã‚‰+1ã§æœˆæ›œ
        if (d.getDay() === 6) d.setDate(d.getDate() + 2);
        else if (d.getDay() === 0) d.setDate(d.getDate() + 1);
        return d.toISOString().split('T')[0];
    }
};

/**
 * ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»Stateç®¡ç†
 */
const Store = {
    state: {
        products: [], // {id, code, name, maker, model, category, min_stock, stock, price, lead_time, cycle_days, note, last_check_date, order_status, is_deleted}
        history: [],  // {id, date, product_id, type, amount, balance, reason_main, reason_detail, note}
        inputHist: { categories: [], makers: [] }, // å…¥åŠ›è£œåŠ©ç”¨
        stocktaking: null // æ£šå¸ä¸€æ™‚ä¿å­˜ { currentIndex, data: {} }
    },

    init() {
        const saved = localStorage.getItem('inventory_app_v1');
        if (saved) {
            this.state = JSON.parse(saved);
        } else {
            // åˆæœŸãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆåˆå›ã®ã¿ï¼‰
            this.state.products = [
                {id: 'p1', code: 'A001', name: 'M4ãƒœãƒ«ãƒˆ', maker: 'ãƒã‚¸å·¥æ¥­', model: 'M4-20', category: 'æ¶ˆè€—å“', min_stock: 50, stock: 40, price: 10, lead_time: 3, cycle_days: 0, note: '', order_status: 'NONE'},
                {id: 'p2', code: 'B002', name: 'ãƒ‰ãƒªãƒ«åˆƒ 5mm', maker: 'ãƒ„ãƒ¼ãƒ«Co', model: 'D-50', category: 'å·¥å…·', min_stock: 5, stock: 10, price: 500, lead_time: 7, cycle_days: 30, note: '', order_status: 'NONE'}
            ];
            this.state.inputHist.categories = ['æ¶ˆè€—å“', 'å·¥å…·', 'å‚™å“'];
            this.save();
        }
    },

    save() {
        localStorage.setItem('inventory_app_v1', JSON.stringify(this.state));
    },

    // å±¥æ­´è¿½åŠ ã¨åœ¨åº«æ›´æ–°
    addTransaction(productId, type, amount, reasonMain, reasonDetail, note, isCorrection = false) {
        const p = this.state.products.find(x => x.id === productId);
        if(!p) return;

        let newStock = p.stock;
        if (!isCorrection) {
            if (type === 'USE' || type === 'OUT') newStock -= amount;
            if (type === 'IN') newStock += amount;
            if (type === 'ADJ') newStock = amount; // æ£šå¸ã¯ä¸Šæ›¸ã
        }
        
        // å•†å“åœ¨åº«æ›´æ–°
        p.stock = newStock;
        
        // ç™ºæ³¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è§£é™¤åˆ¤å®š
        if (type === 'IN' && p.order_status === 'ORDERED') {
            p.order_status = 'NONE';
        }

        // å±¥æ­´è¨˜éŒ²
        this.state.history.unshift({
            id: Utils.uuid(),
            date: new Date().toISOString(),
            product_id: p.id,
            product_code: p.code, // ã‚³ãƒ¼ãƒ‰å¤‰æ›´è¿½å¾“ã®ãŸã‚ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚‚æŒã¤ãŒã€ãƒªãƒ³ã‚¯ç”¨ã«IDå¿…é ˆ
            product_name: p.name,
            category: p.category,
            type, amount, balance: newStock,
            reason_main: reasonMain,
            reason_detail: reasonDetail,
            note
        });

        // å±¥æ­´ã¯æœ€æ–°1000ä»¶ä¿æŒ
        if (this.state.history.length > 1000) this.state.history.length = 1000;
        
        // å…¥åŠ›å­¦ç¿’
        if(p.category && !this.state.inputHist.categories.includes(p.category)) this.state.inputHist.categories.push(p.category);
        if(p.maker && !this.state.inputHist.makers.includes(p.maker)) this.state.inputHist.makers.push(p.maker);

        this.save();
    },
    
    // å•†å“ä¿å­˜ (Upsert)
    upsertProduct(data) {
        const exists = this.state.products.find(p => p.id === data.id);
        if (exists) {
            Object.assign(exists, data);
        } else {
            this.state.products.push(data);
        }
        // ãƒã‚¹ã‚¿å¤‰æ›´æ™‚ã«ã‚³ãƒ¼ãƒ‰ãŒå¤‰ã‚ã£ã¦ã„ãŸã‚‰å±¥æ­´ã‚‚...ï¼ˆä»Šå›ã¯ç°¡æ˜“åŒ–ã®ãŸã‚IDç®¡ç†ã¨ã—ã€è¡¨ç¤ºæ™‚ã«æœ€æ–°ãƒã‚¹ã‚¿ã‚’å‚ç…§ã™ã‚‹å½¢å¼ã‚’ã¨ã‚‹ãŒã€å±¥æ­´ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚‚è¦ä»¶ã«ã‚ã‚‹ãŸã‚ã€å±¥æ­´è¡¨ç¤ºæ™‚ã«ãƒã‚¹ã‚¿å‚ç…§ã‚’å„ªå…ˆã™ã‚‹ï¼‰
        this.save();
    }
};

/**
 * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ & UIãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
 */
const app = {
    currentView: 'inventory',

    init() {
        Store.init();
        this.router('inventory');
        
        // iOSã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾ç­–
        document.body.addEventListener('touchmove', (e) => {
            if (document.getElementById('modal').classList.contains('active')) {
                // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯è¨±å¯ã€èƒŒæ™¯ã¯ç¦æ­¢
                if (!e.target.closest('.modal-content')) e.preventDefault();
            }
        }, { passive: false });
    },

    // --- Routing ---
    router(view) {
        this.currentView = view;
        const container = document.getElementById('app-container');
        const navItems = document.querySelectorAll('.nav-item');
        
        navItems.forEach(el => el.classList.remove('active'));
        document.querySelector(`.nav-item[onclick*="'${view}'"]`).classList.add('active');
        
        container.innerHTML = '';
        this.closeModal();

        switch(view) {
            case 'inventory': this.renderInventory(container); break;
            case 'history': this.renderHistory(container); break;
            case 'master': this.renderMaster(container); break;
            case 'calendar': this.renderCalendar(container); break;
            case 'settings': this.renderSettings(container); break;
        }
    },

    // --- 1. åœ¨åº«æ“ä½œç”»é¢ ---
    renderInventory(container) {
        document.getElementById('page-title').textContent = 'åœ¨åº«æ“ä½œä¸€è¦§';
        
        container.innerHTML = `
            <div class="switch-wrap">
                <span>åœ¨åº«ä¸è¶³ã®ã¿è¡¨ç¤º</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-low-stock" onchange="app.renderInventoryList()">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="filter-bar">
                <input type="text" id="search-inv" class="search-box" placeholder="åç§°ãƒ»ã‚³ãƒ¼ãƒ‰æ¤œç´¢..." onkeyup="app.renderInventoryList()">
                <button class="btn btn-outline btn-sm" onclick="app.showCategoryFilter()">åˆ†é¡â–¼</button>
            </div>
            <div id="inv-list"></div>
        `;
        this.renderInventoryList();
    },

    renderInventoryList(filterCat = null) {
        const onlyLow = document.getElementById('toggle-low-stock')?.checked;
        const search = document.getElementById('search-inv')?.value.toLowerCase() || '';
        const listEl = document.getElementById('inv-list');
        
        let items = Store.state.products.filter(p => !p.is_deleted);

        if (onlyLow) items = items.filter(p => p.stock < p.min_stock);
        if (filterCat) items = items.filter(p => p.category === filterCat);
        if (search) items = items.filter(p => p.name.toLowerCase().includes(search) || p.code.toLowerCase().includes(search));

        listEl.innerHTML = items.map(p => {
            const isLow = p.stock < p.min_stock;
            const isOrdered = p.order_status === 'ORDERED';
            const rowClass = isLow ? 'alert-row' : (isOrdered ? 'order-row' : '');
            const badgeColor = Utils.getColor(p.category);
            
            return `
            <div class="card ${rowClass}">
                <div class="stock-row">
                    <div>
                        <span class="cat-badge" style="background:${badgeColor}">${p.category}</span>
                        <div style="font-weight:bold; margin-top:4px;">${p.name} <small style="color:var(--subtext)">(${p.code})</small></div>
                        ${isLow ? '<div class="text-danger" style="font-size:12px; margin-top:2px;">âš ï¸ è³¼å…¥ä¾é ¼ã—ã¦ãã ã•ã„</div>' : ''}
                        ${isOrdered ? '<div class="text-warning" style="font-size:12px;">ğŸšš ç™ºæ³¨ä¾é ¼ä¸­</div>' : ''}
                    </div>
                    <div class="stock-val ${isLow ? 'text-danger' : ''}">${p.stock} <small style="font-size:12px; color:var(--text)">/ ${p.min_stock}</small></div>
                </div>
                <div class="stock-actions">
                    <button class="btn btn-primary btn-sm" onclick="app.modalUse('${p.id}')">ä½¿ç”¨</button>
                    <button class="btn btn-outline btn-sm" onclick="app.modalIn('${p.id}')">ç´å…¥</button>
                    <button class="btn btn-warning btn-sm" style="background:#FF9500; color:white; border:none;" onclick="app.modalOrder('${p.id}')">ç™ºæ³¨</button>
                </div>
            </div>`;
        }).join('');
    },

    showCategoryFilter() {
        const cats = Store.state.inputHist.categories;
        const html = cats.map(c => `<button class="btn btn-outline" style="margin-bottom:8px" onclick="app.renderInventoryList('${c}'); app.closeModal()">${c}</button>`).join('') + 
                     `<button class="btn btn-secondary" onclick="app.renderInventoryList(null); app.closeModal()">å…¨è¡¨ç¤º</button>`;
        this.openModal('ã‚«ãƒ†ã‚´ãƒªãƒ¼çµã‚Šè¾¼ã¿', html);
    },

    // Modal Operations
    modalUse(id) {
        const p = Store.state.products.find(x => x.id === id);
        const html = `
            <h3>${p.name} (åœ¨åº«: ${p.stock})</h3>
            <label>ä½¿ç”¨æ•°é‡</label>
            <input type="number" id="use-amount" inputmode="numeric" value="1">
            <label>ä½¿ç”¨ç¨®åˆ¥</label>
            <select id="use-type" onchange="document.getElementById('detail-reason-box').style.display = this.value === 'çªç™º' ? 'block' : 'none'">
                <option value="é€šå¸¸">é€šå¸¸ä½¿ç”¨ (å®šæœŸ)</option>
                <option value="çªç™º">çªç™ºäº¤æ›</option>
            </select>
            <div id="detail-reason-box" style="display:none">
                <label>è©³ç´°ç†ç”±</label>
                <select id="use-detail">
                    <option value="ç ´æ">ç ´æ</option>
                    <option value="ç´›å¤±">ç´›å¤±</option>
                    <option value="æ‘©è€—">æ‘©è€—</option>
                    <option value="åŠ£åŒ–">åŠ£åŒ–</option>
                </select>
            </div>
            <label>å‚™è€ƒ</label>
            <input type="text" id="use-note" placeholder="ä½œæ¥­Noãªã©">
            <button class="btn btn-primary" onclick="app.execUse('${id}')">ä½¿ç”¨ç¢ºå®š</button>
        `;
        this.openModal('åœ¨åº«ä½¿ç”¨', html);
    },

    execUse(id) {
        const amount = parseInt(document.getElementById('use-amount').value);
        const type = document.getElementById('use-type').value;
        const detail = type === 'çªç™º' ? document.getElementById('use-detail').value : '';
        const note = document.getElementById('use-note').value;
        
        if (!amount || amount <= 0) return alert('æ•°é‡ã‚’å…¥ã‚Œã¦ãã ã•ã„');
        
        Store.addTransaction(id, 'USE', amount, type, detail, note);
        this.closeModal();
        this.renderInventory();
    },

    modalIn(id) {
        const html = `
            <label>ç´å…¥æ•°é‡</label>
            <input type="number" id="in-amount" inputmode="numeric" value="">
            <label>å‚™è€ƒ</label>
            <input type="text" id="in-note">
            <button class="btn btn-primary" onclick="app.execIn('${id}')">ç´å…¥ç¢ºå®š</button>
        `;
        this.openModal('ç´å…¥ç™»éŒ²', html);
    },

    execIn(id) {
        const amount = parseInt(document.getElementById('in-amount').value);
        const note = document.getElementById('in-note').value;
        if (!amount || amount <= 0) return alert('æ­£ã®æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        Store.addTransaction(id, 'IN', amount, 'ç´å…¥', '', note);
        this.closeModal();
        this.renderInventory();
    },

    modalOrder(id) {
        const p = Store.state.products.find(x => x.id === id);
        const html = `
            <p>ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <strong>${p.order_status === 'ORDERED' ? 'ç™ºæ³¨æ¸ˆ' : 'æœªç™ºæ³¨'}</strong></p>
            <label>ç™ºæ³¨æ•°é‡</label>
            <input type="number" id="order-amount" inputmode="numeric" value="${p.min_stock > p.stock ? p.min_stock - p.stock : 1}">
            <label>ç´å…¥äºˆå®šæ—¥</label>
            <input type="date" id="order-date">
            <button class="btn btn-warning" style="color:white" onclick="app.execOrder('${id}')">ç™ºæ³¨ä¾é ¼ã™ã‚‹</button>
            ${p.order_status === 'ORDERED' ? `<button class="btn btn-outline mt-2" onclick="app.cancelOrder('${id}')" style="margin-top:10px">ç™ºæ³¨å–æ¶ˆ</button>` : ''}
        `;
        this.openModal('ç™ºæ³¨ä¾é ¼', html);
    },

    execOrder(id) {
        const amount = document.getElementById('order-amount').value;
        const date = document.getElementById('order-date').value;
        const p = Store.state.products.find(x => x.id === id);
        p.order_status = 'ORDERED';
        Store.addTransaction(id, 'ORDER', amount, 'ç™ºæ³¨ä¾é ¼', '', `ç´å…¥äºˆå®š: ${date}`);
        this.closeModal();
        this.renderInventory();
    },
    
    cancelOrder(id) {
        const p = Store.state.products.find(x => x.id === id);
        p.order_status = 'NONE';
        Store.save();
        this.closeModal();
        this.renderInventory();
    },

    // --- 2. å±¥æ­´ç®¡ç†ç”»é¢ ---
    renderHistory(container) {
        document.getElementById('page-title').textContent = 'æ“ä½œå±¥æ­´ (æœ€æ–°1000ä»¶)';
        const hist = Store.state.history;
        
        container.innerHTML = `
            <input type="text" id="hist-search" class="search-box" placeholder="æ¤œç´¢..." onkeyup="app.filterHistory()">
            <div id="hist-list">
                ${this.buildHistoryHTML(hist)}
            </div>
        `;
    },

    buildHistoryHTML(list) {
        return list.map(h => {
            const isEdit = h.type === 'ADJ' || h.type === 'CORRECT';
            return `
            <div class="card" onclick="app.editHistory('${h.id}')">
                <div style="display:flex; justify-content:space-between; font-size:12px; color:var(--subtext)">
                    <span>${Utils.formatDate(h.date)}</span>
                    <span>${h.type}</span>
                </div>
                <div style="font-weight:bold; margin:4px 0;">${h.product_name} (${h.amount}å€‹)</div>
                <div style="font-size:13px;">æ®‹: ${h.balance} | ${h.reason_main} ${h.reason_detail ? '('+h.reason_detail+')' : ''}</div>
                <div style="font-size:12px; color:var(--subtext)">${h.note || ''}</div>
            </div>`;
        }).join('');
    },

    filterHistory() {
        const term = document.getElementById('hist-search').value.toLowerCase();
        const filtered = Store.state.history.filter(h => 
            h.product_name.toLowerCase().includes(term) || 
            h.category.toLowerCase().includes(term) ||
            h.reason_main.includes(term)
        );
        document.getElementById('hist-list').innerHTML = this.buildHistoryHTML(filtered);
    },

    editHistory(id) {
        const h = Store.state.history.find(x => x.id === id);
        if(h.type === 'ORDER') return; // ç™ºæ³¨å±¥æ­´ã¯ç·¨é›†å¯¾è±¡å¤–ã¨ã™ã‚‹ï¼ˆè¦ä»¶åˆ¤æ–­ï¼‰

        const html = `
            <p class="text-danger">æ³¨æ„: æ•°é‡ã‚’å¤‰æ›´ã™ã‚‹ã¨ç¾åœ¨ã®åœ¨åº«æ•°ãŒè‡ªå‹•èª¿æ•´ã•ã‚Œã¾ã™ã€‚</p>
            <label>æ•°é‡</label>
            <input type="number" id="edit-hist-amount" value="${h.amount}">
            <label>ç†ç”±</label>
            <input type="text" id="edit-hist-reason" value="${h.reason_main}">
            <label>å‚™è€ƒ</label>
            <input type="text" id="edit-hist-note" value="${h.note}">
            <button class="btn btn-primary" onclick="app.saveHistory('${id}')">ä¿®æ­£ä¿å­˜</button>
        `;
        this.openModal('å±¥æ­´ä¿®æ­£', html);
    },

    saveHistory(id) {
        const h = Store.state.history.find(x => x.id === id);
        const newAmount = parseInt(document.getElementById('edit-hist-amount').value);
        const newReason = document.getElementById('edit-hist-reason').value;
        const newNote = document.getElementById('edit-hist-note').value;
        
        // å·®åˆ†è¨ˆç®—
        const diff = newAmount - h.amount;
        
        // å±¥æ­´æ›´æ–°
        h.amount = newAmount;
        h.reason_main = newReason;
        h.note = newNote + ' (ä¿®æ­£æ¸ˆ)';
        
        // ç¾åœ¨åœ¨åº«ã¸ã®åæ˜ ï¼ˆç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯: éå»ã®å¤‰æ›´ã¯ç¾åœ¨ã®åœ¨åº«ã«å·®åˆ†ã¨ã—ã¦é©ç”¨ï¼‰
        const p = Store.state.products.find(x => x.id === h.product_id);
        if (p) {
            if (h.type === 'IN') p.stock += diff;
            else if (h.type === 'USE' || h.type === 'OUT') p.stock -= diff;
            // ADJã®å ´åˆã¯ã€éå»ã®å®Ÿæ•°ãŒå¤‰ã‚ã‚‹ã ã‘ãªã®ã§ç¾åœ¨åº«ã¸ã®å½±éŸ¿ãƒ­ã‚¸ãƒƒã‚¯ã¯è¤‡é›‘ã€‚ä»Šå›ã¯ç°¡æ˜“çš„ã«IN/OUTã®ã¿å¯¾å¿œã€‚
        }
        
        Store.save();
        this.closeModal();
        this.renderHistory(document.getElementById('app-container'));
    },

    // --- 3. ãƒã‚¹ã‚¿ãƒ»æ£šå¸ ---
    renderMaster(container) {
        document.getElementById('page-title').textContent = 'ãƒã‚¹ã‚¿ç®¡ç† & æ£šå¸';
        container.innerHTML = `
            <div style="display:flex; gap:10px; margin-bottom:16px;">
                <button class="btn btn-primary" onclick="app.modalProduct()">ï¼‹ æ–°è¦å•†å“</button>
                <button class="btn btn-warning" style="color:white" onclick="app.startStocktaking()">ğŸ“‹ æ£šå¸é–‹å§‹</button>
            </div>
            <div class="card">
                <h3>å•†å“ä¸€è¦§</h3>
                ${Store.state.products.filter(p=>!p.is_deleted).map(p => `
                    <div style="padding:8px 0; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:bold">${p.name}</div>
                            <div style="font-size:12px; color:var(--subtext)">${p.code} / ${p.category}</div>
                        </div>
                        <button class="btn btn-outline btn-sm" onclick="app.modalProduct('${p.id}')">ç·¨é›†</button>
                    </div>
                `).join('')}
            </div>
        `;
    },

    modalProduct(id = null) {
        const p = id ? Store.state.products.find(x => x.id === id) : {
            id: Utils.uuid(), code:'', name:'', maker:'', model:'', category:'', min_stock:0, stock:0, price:0, lead_time:0, cycle_days:0, note:'', is_deleted:false
        };
        
        const catOpts = Store.state.inputHist.categories.map(c => `<option value="${c}">`).join('');
        const makerOpts = Store.state.inputHist.makers.map(m => `<option value="${m}">`).join('');

        const html = `
            <label>å•†å“ã‚³ãƒ¼ãƒ‰ *</label><input type="text" id="m-code" value="${p.code}" ${id?'readonly':''}>
            <label>å“å</label><input type="text" id="m-name" value="${p.name}">
            <label>ã‚«ãƒ†ã‚´ãƒª</label><input type="text" id="m-cat" value="${p.category}" list="cat-list"><datalist id="cat-list">${catOpts}</datalist>
            <label>ãƒ¡ãƒ¼ã‚«ãƒ¼</label><input type="text" id="m-maker" value="${p.maker}" list="maker-list"><datalist id="maker-list">${makerOpts}</datalist>
            <label>å‹å¼</label><input type="text" id="m-model" value="${p.model}">
            <div style="display:flex; gap:8px">
                <div style="flex:1"><label>åŸºæº–åœ¨åº«</label><input type="number" id="m-min" value="${p.min_stock}"></div>
                <div style="flex:1"><label>ç¾åœ¨åº«</label><input type="number" id="m-stock" value="${p.stock}" ${id?'readonly':''}></div>
            </div>
            <div style="display:flex; gap:8px">
                <div style="flex:1"><label>å˜ä¾¡</label><input type="number" id="m-price" value="${p.price}"></div>
                <div style="flex:1"><label>äº¤æ›å‘¨æœŸ(æ—¥)</label><input type="number" id="m-cycle" value="${p.cycle_days}"></div>
            </div>
            <label>å‚™è€ƒ</label><input type="text" id="m-note" value="${p.note}">
            <button class="btn btn-primary" onclick="app.saveProduct('${p.id}')">ä¿å­˜</button>
            ${id ? `<button class="btn btn-danger mt-2" style="margin-top:10px" onclick="app.deleteProduct('${id}')">å‰Šé™¤</button>` : ''}
        `;
        this.openModal(id ? 'å•†å“ç·¨é›†' : 'æ–°è¦ç™»éŒ²', html);
    },

    saveProduct(id) {
        const data = {
            id: id,
            code: document.getElementById('m-code').value,
            name: document.getElementById('m-name').value,
            category: document.getElementById('m-cat').value,
            maker: document.getElementById('m-maker').value,
            model: document.getElementById('m-model').value,
            min_stock: parseInt(document.getElementById('m-min').value),
            stock: parseInt(document.getElementById('m-stock').value),
            price: parseInt(document.getElementById('m-price').value),
            cycle_days: parseInt(document.getElementById('m-cycle').value),
            note: document.getElementById('m-note').value,
            is_deleted: false,
            // æ—¢å­˜ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç¶­æŒ
            last_check_date: null,
            order_status: 'NONE'
        };
        
        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if(!data.code || !data.name) return alert('ã‚³ãƒ¼ãƒ‰ã¨å“åã¯å¿…é ˆã§ã™');
        const dup = Store.state.products.find(p => p.code === data.code && p.id !== id);
        if(dup) return alert('ã‚³ãƒ¼ãƒ‰ãŒé‡è¤‡ã—ã¦ã„ã¾ã™');

        Store.upsertProduct(data);
        this.closeModal();
        this.renderMaster(document.getElementById('app-container'));
    },

    deleteProduct(id) {
        if(!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
        const p = Store.state.products.find(x => x.id === id);
        p.is_deleted = true;
        Store.save();
        this.closeModal();
        this.renderMaster(document.getElementById('app-container'));
    },

    // --- æ£šå¸æ©Ÿèƒ½ (ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰å½¢å¼) ---
    startStocktaking() {
        const activeProducts = Store.state.products.filter(p => !p.is_deleted);
        if(activeProducts.length === 0) return alert('å•†å“ãŒã‚ã‚Šã¾ã›ã‚“');
        
        // é€”ä¸­å†é–‹ãƒã‚§ãƒƒã‚¯
        if (localStorage.getItem('stock_temp')) {
            if (confirm('å‰å›ã®æ£šå¸ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚å†é–‹ã—ã¾ã™ã‹ï¼Ÿ')) {
                Store.state.stocktaking = JSON.parse(localStorage.getItem('stock_temp'));
                this.renderStocktaking();
                return;
            }
        }
        
        Store.state.stocktaking = {
            currentIndex: 0,
            ids: activeProducts.map(p => p.id),
            results: {} // id: actual_stock
        };
        this.saveStockTemp();
        this.renderStocktaking();
    },

    saveStockTemp() {
        localStorage.setItem('stock_temp', JSON.stringify(Store.state.stocktaking));
    },

    renderStocktaking() {
        const st = Store.state.stocktaking;
        if (st.currentIndex >= st.ids.length) {
            this.renderStockFinish();
            return;
        }

        const pid = st.ids[st.currentIndex];
        const p = Store.state.products.find(x => x.id === pid);
        const container = document.getElementById('app-container');
        document.getElementById('page-title').textContent = `æ£šå¸ (${st.currentIndex + 1}/${st.ids.length})`;

        container.innerHTML = `
            <div class="card" style="text-align:center; padding:40px 20px;">
                <div style="font-size:14px; color:#888">${p.category}</div>
                <h2 style="font-size:24px; margin:10px 0;">${p.name}</h2>
                <div style="font-size:16px; margin-bottom:20px;">${p.maker} / ${p.model}</div>
                <div style="margin-bottom:20px; font-size:14px;">ã‚·ã‚¹ãƒ†ãƒ åœ¨åº«: <b>${p.stock}</b></div>
                
                <label>å®Ÿåœ¨åº«ã‚’å…¥åŠ›</label>
                <input type="number" id="st-actual" style="font-size:32px; text-align:center;" inputmode="numeric" value="${st.results[pid] !== undefined ? st.results[pid] : ''}" placeholder="?">
                
                <div style="display:grid; gap:12px; margin-top:20px;">
                    <button class="btn btn-primary" onclick="app.nextStock(true)">OK (æ¬¡ã¸)</button>
                    <button class="btn btn-outline" onclick="app.nextStock(false)">ã‚¹ã‚­ãƒƒãƒ— (å¤‰æ›´ãªã—)</button>
                    <button class="btn btn-secondary" style="margin-top:20px; font-size:12px" onclick="app.quitStock()">ä¸­æ–­ã—ã¦ä¿å­˜</button>
                </div>
            </div>
        `;
        document.getElementById('st-actual').focus();
    },

    nextStock(isCommit) {
        const val = document.getElementById('st-actual').value;
        const st = Store.state.stocktaking;
        
        if (isCommit) {
            if (val === '') return alert('æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            st.results[st.ids[st.currentIndex]] = parseInt(val);
        }
        
        st.currentIndex++;
        this.saveStockTemp();
        this.renderStocktaking();
    },

    quitStock() {
        alert('é€²æ—ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚æ¬¡å›ã€Œæ£šå¸é–‹å§‹ã€ã§å†é–‹ã§ãã¾ã™ã€‚');
        this.router('master');
    },

    renderStockFinish() {
        const st = Store.state.stocktaking;
        const count = Object.keys(st.results).length;
        
        document.getElementById('app-container').innerHTML = `
            <div class="card">
                <h2>æ£šå¸å®Œäº†</h2>
                <p>å…¥åŠ›æ¸ˆã¿: ${count} ä»¶</p>
                <p>ç¢ºå®šã™ã‚‹ã¨ã€å…¥åŠ›ã—ãŸå®Ÿåœ¨åº«ã§ã‚·ã‚¹ãƒ†ãƒ åœ¨åº«ã‚’ä¸Šæ›¸ãã—ã€å·®ç•°ã‚’å±¥æ­´ã«è¨˜éŒ²ã—ã¾ã™ã€‚</p>
                <button class="btn btn-danger" onclick="app.commitStocktaking()">ç¢ºå®šå®Ÿè¡Œ</button>
            </div>
        `;
    },

    commitStocktaking() {
        const st = Store.state.stocktaking;
        const date = new Date().toISOString();
        
        for (const [id, actual] of Object.entries(st.results)) {
            const p = Store.state.products.find(x => x.id === id);
            if (!p) continue;
            
            const diff = actual - p.stock;
            if (diff !== 0) {
                Store.addTransaction(id, 'ADJ', actual, 'æ£šå¸', '', `ã‚·ã‚¹ãƒ†ãƒ :${p.stock} -> å®Ÿ:${actual}`);
            }
            p.last_check_date = date;
        }
        
        Store.save();
        localStorage.removeItem('stock_temp');
        alert('æ£šå¸ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚');
        this.router('inventory');
    },

    // --- 4. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ---
    renderCalendar(container) {
        document.getElementById('page-title').textContent = 'äº¤æ›äºˆå®šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼';
        
        // äº¤æ›å‘¨æœŸè¨­å®šã‚ã‚Šã®å•†å“ã‚’æŠ½å‡º
        const items = Store.state.products.filter(p => !p.is_deleted && p.cycle_days > 0);
        
        // æ¬¡å›äº¤æ›æ—¥è¨ˆç®—
        const events = items.map(p => {
            // å±¥æ­´ã‹ã‚‰æœ€çµ‚ä½¿ç”¨æ—¥ã‚’æ¢ã™
            const lastUse = Store.state.history.find(h => h.product_id === p.id && h.type === 'USE');
            const baseDate = lastUse ? lastUse.date : new Date().toISOString();
            const nextDate = Utils.addBusinessDays(baseDate, p.cycle_days);
            return { product: p, date: nextDate };
        }).sort((a,b) => a.date.localeCompare(b.date));

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ (å½“æœˆè¡¨ç¤ºã®ã¿ç°¡æ˜“å®Ÿè£…)
        const today = new Date();
        const y = today.getFullYear(), m = today.getMonth();
        const firstDay = new Date(y, m, 1).getDay(); // 0=Sun
        const lastDate = new Date(y, m + 1, 0).getDate();
        
        let calHTML = '<div class="week-header"><div>æ—¥</div><div>æœˆ</div><div>ç«</div><div>æ°´</div><div>æœ¨</div><div>é‡‘</div><div>åœŸ</div></div><div class="calendar-grid">';
        
        // ç©ºç™½
        for(let i=0; i<firstDay; i++) calHTML += `<div></div>`;
        
        // æ—¥ä»˜
        for(let d=1; d<=lastDate; d++) {
            const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const isToday = d === today.getDate();
            const dayEvents = events.filter(e => e.date === dateStr);
            const hasEvent = dayEvents.length > 0;
            
            calHTML += `
                <div class="cal-day ${hasEvent ? 'has-event' : ''} ${isToday ? 'today' : ''}" onclick="app.showDayEvents('${dateStr}')">
                    ${d}
                </div>`;
        }
        calHTML += '</div>';

        // ãƒªã‚¹ãƒˆè¡¨ç¤º
        const listHTML = events.map(e => `
            <div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between">
                <div>${e.date}</div>
                <div style="font-weight:bold">${e.product.name}</div>
            </div>
        `).join('');

        container.innerHTML = `
            <div class="card" style="height:60vh; overflow:hidden; display:flex; flex-direction:column;">
                <h3 style="text-align:center; margin-bottom:10px;">${y}å¹´ ${m+1}æœˆ</h3>
                ${calHTML}
            </div>
            <div class="card">
                <h3>äº¤æ›äºˆå®šãƒªã‚¹ãƒˆ</h3>
                ${listHTML || '<p style="color:#888">äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</p>'}
            </div>
        `;
    },

    showDayEvents(date) {
        // ç°¡æ˜“å®Ÿè£…: ãã®æ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¢ãƒ©ãƒ¼ãƒˆã‹ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        const items = Store.state.products.filter(p => !p.is_deleted && p.cycle_days > 0);
        const target = items.filter(p => {
             const lastUse = Store.state.history.find(h => h.product_id === p.id && h.type === 'USE');
             const base = lastUse ? lastUse.date : new Date().toISOString();
             return Utils.addBusinessDays(base, p.cycle_days) === date;
        });
        
        if(target.length > 0) {
            alert(`${date} ã®äº¤æ›äºˆå®š:\n\n` + target.map(p => `ãƒ»${p.name}`).join('\n'));
        }
    }
    ,

    // --- 5. è¨­å®šãƒ»ãƒ‡ãƒ¼ã‚¿é€£æº ---
    renderSettings(container) {
        document.getElementById('page-title').textContent = 'ãƒ‡ãƒ¼ã‚¿ç®¡ç†';
        container.innerHTML = `
            <div class="card">
                <h3>CSVé€£æº</h3>
                <button class="btn btn-outline" onclick="app.exportCSV('products')">å•†å“ãƒã‚¹ã‚¿æ›¸å‡º</button>
                <button class="btn btn-outline mt-2" style="margin-top:10px" onclick="app.exportCSV('history')">å±¥æ­´ãƒ‡ãƒ¼ã‚¿æ›¸å‡º</button>
                <hr style="margin:16px 0; border:none; border-top:1px solid #eee;">
                <label>å•†å“CSVå–è¾¼ (ä¸Šæ›¸ã/è¿½åŠ )</label>
                <input type="file" accept=".csv" onchange="app.importCSV(this)">
            </div>
            <div class="card">
                <h3>å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h3>
                <button class="btn btn-primary" onclick="app.backupJSON()">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿å­˜ (JSON)</button>
                <label style="margin-top:16px">å¾©å…ƒ</label>
                <input type="file" accept=".json" onchange="app.restoreJSON(this)">
            </div>
            <div class="card">
                <button class="btn btn-danger" onclick="if(confirm('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) { localStorage.clear(); location.reload(); }">å…¨ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
            </div>
        `;
    },

    // CSV/JSON Logic
    exportCSV(type) {
        let csv = '';
        if (type === 'products') {
            const items = Store.state.products;
            const header = ['id','code','name','maker','model','category','stock','min_stock','price','lead_time','cycle_days','note'];
            csv = header.join(',') + '\n' + items.map(p => header.map(k => `"${(p[k]||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n');
        } else {
            const items = Store.state.history;
            const header = ['date','type','product_code','product_name','amount','balance','reason_main','reason_detail','note'];
            csv = header.join(',') + '\n' + items.map(h => header.map(k => `"${(h[k]||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n');
        }
        
        const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${type}_${Utils.formatDateShort(new Date())}.csv`;
        a.click();
    },

    importCSV(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = Utils.parseCSV(e.target.result);
            if (data.length === 0) return;
            
            let count = 0;
            data.forEach(row => {
                if(!row.code || !row.name) return;
                // æ—¢å­˜æ¤œç´¢
                let p = Store.state.products.find(x => x.code === row.code);
                if (!p) {
                    p = { id: Utils.uuid(), code: row.code, stock: 0, min_stock:0, is_deleted: false, order_status: 'NONE' };
                    Store.state.products.push(p);
                }
                // Update fields
                p.name = row.name;
                p.category = row.category || p.category;
                p.maker = row.maker || p.maker;
                p.model = row.model || p.model;
                if(row.min_stock) p.min_stock = parseInt(row.min_stock);
                if(row.price) p.price = parseInt(row.price);
                if(row.cycle_days) p.cycle_days = parseInt(row.cycle_days);
                count++;
            });
            Store.save();
            alert(`${count}ä»¶ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†`);
            input.value = '';
        };
        reader.readAsText(file);
    },

    backupJSON() {
        const blob = new Blob([JSON.stringify(Store.state)], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `inventory_backup_${Utils.formatDateShort(new Date())}.json`;
        a.click();
    },

    restoreJSON(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                if (data.products && data.history) {
                    Store.state = data;
                    Store.save();
                    alert('å¾©å…ƒå®Œäº†');
                    location.reload();
                } else {
                    alert('ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒä¸æ­£ã§ã™');
                }
            } catch(err) {
                alert('èª­è¾¼ã‚¨ãƒ©ãƒ¼');
            }
        };
        reader.readAsText(file);
    },

    // Utilities
    openModal(title, contentHTML) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-body').innerHTML = contentHTML;
        document.getElementById('modal').classList.add('active');
        document.getElementById('main-nav').style.display = 'none'; // ãƒŠãƒ“éè¡¨ç¤º
    },
    closeModal() {
        document.getElementById('modal').classList.remove('active');
        document.getElementById('main-nav').style.display = 'flex';
    }
};

// èµ·å‹•
window.onload = () => app.init();
</script>
</body>
</html>
